<!DOCTYPE html>

<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾é£Ÿç«™é»é¤ç³»çµ± | Food Stand Ordering</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Righteous&display=swap" rel="stylesheet">

```
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>
    :root {
        --primary: #FF6B35;
        --primary-dark: #E85A2A;
        --secondary: #F7931E;
        --accent: #FDC830;
        --success: #4CAF50;
        --danger: #E63946;
        --bg-light: #FFF9F0;
        --bg-white: #FFFFFF;
        --text-dark: #2D3142;
        --text-muted: #6B6B6B;
        --shadow: rgba(255, 107, 53, 0.15);
        --border: #FFE5D9;
    }

    .dark {
        --bg-light: #1a1a2e;
        --bg-white: #16213e;
        --text-dark: #eaeaea;
        --text-muted: #a0a0a0;
        --shadow: rgba(0, 0, 0, 0.3);
        --border: #2d3142;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Noto Sans TC', sans-serif;
        background: var(--bg-light);
        color: var(--text-dark);
        min-height: 100vh;
        transition: background 0.3s ease, color 0.3s ease;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    /* Header */
    .header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        padding: 30px 20px;
        text-align: center;
        box-shadow: 0 4px 20px var(--shadow);
        position: relative;
        overflow: hidden;
    }

    .header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -10%;
        width: 300px;
        height: 300px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
    }

    .header::after {
        content: '';
        position: absolute;
        bottom: -30%;
        left: -5%;
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
    }

    .header h1 {
        font-family: 'Righteous', cursive;
        font-size: 2.5em;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .header p {
        font-size: 1.1em;
        opacity: 0.95;
        position: relative;
        z-index: 1;
    }

    /* View Toggle */
    .view-toggle {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin: 30px 0;
        flex-wrap: wrap;
    }

    .toggle-btn {
        padding: 12px 30px;
        border: none;
        border-radius: 50px;
        font-size: 1em;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Noto Sans TC', sans-serif;
        box-shadow: 0 4px 10px var(--shadow);
    }

    .toggle-btn.active {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 15px var(--shadow);
    }

    .toggle-btn:not(.active) {
        background: var(--bg-white);
        color: var(--text-dark);
    }

    .toggle-btn:hover:not(.active) {
        transform: translateY(-2px);
    }

    /* Menu Items */
    .menu-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        margin-top: 30px;
    }

    .menu-item {
        background: var(--bg-white);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 20px var(--shadow);
        transition: all 0.3s ease;
        border: 2px solid var(--border);
    }

    .menu-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px var(--shadow);
    }

    .item-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
    }

    .item-emoji {
        font-size: 3em;
        filter: drop-shadow(2px 2px 4px var(--shadow));
    }

    .item-info h3 {
        font-size: 1.3em;
        color: var(--primary);
        margin-bottom: 5px;
    }

    .item-info .english {
        font-size: 0.9em;
        color: var(--text-muted);
    }

    .item-price {
        font-size: 1.8em;
        font-weight: 700;
        color: var(--secondary);
        margin: 15px 0;
    }

    .add-drink-option {
        background: var(--bg-light);
        padding: 12px;
        border-radius: 12px;
        margin: 15px 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .add-drink-option input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
        accent-color: var(--primary);
    }

    .quantity-control {
        display: flex;
        align-items: center;
        gap: 15px;
        margin: 15px 0;
    }

    .qty-btn {
        width: 40px;
        height: 40px;
        border: 2px solid var(--primary);
        background: var(--bg-white);
        color: var(--primary);
        border-radius: 50%;
        font-size: 1.2em;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .qty-btn:hover {
        background: var(--primary);
        color: white;
        transform: scale(1.1);
    }

    .qty-display {
        font-size: 1.5em;
        font-weight: 700;
        min-width: 40px;
        text-align: center;
    }

    .add-to-cart {
        width: 100%;
        padding: 15px;
        border: none;
        border-radius: 12px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        font-size: 1.1em;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Noto Sans TC', sans-serif;
    }

    .add-to-cart:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px var(--shadow);
    }

    /* Cart Summary */
    .cart-summary {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--bg-white);
        padding: 20px;
        border-radius: 20px;
        box-shadow: 0 8px 25px var(--shadow);
        min-width: 280px;
        border: 2px solid var(--primary);
        z-index: 100;
    }

    .cart-summary h3 {
        color: var(--primary);
        margin-bottom: 15px;
        font-size: 1.3em;
    }

    .cart-item {
        padding: 10px 0;
        border-bottom: 1px solid var(--border);
        font-size: 0.95em;
    }

    .cart-total {
        font-size: 1.5em;
        font-weight: 700;
        color: var(--secondary);
        margin: 15px 0;
        padding-top: 15px;
        border-top: 2px solid var(--border);
    }

    .submit-order {
        width: 100%;
        padding: 15px;
        border: none;
        border-radius: 12px;
        background: linear-gradient(135deg, var(--success), #45a049);
        color: white;
        font-size: 1.2em;
        font-weight: 700;
        cursor: pointer;
        font-family: 'Noto Sans TC', sans-serif;
        transition: all 0.3s ease;
    }

    .submit-order:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(76, 175, 80, 0.3);
    }

    .submit-order:disabled {
        background: var(--text-muted);
        cursor: not-allowed;
        transform: none;
    }

    /* Order Confirmation Modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal.show {
        display: flex;
    }

    .modal-content {
        background: var(--bg-white);
        padding: 40px;
        border-radius: 25px;
        text-align: center;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
        from {
            transform: translateY(-50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .order-number {
        font-size: 4em;
        font-weight: 700;
        color: var(--primary);
        margin: 20px 0;
        font-family: 'Righteous', cursive;
    }

    .modal-close {
        margin-top: 20px;
        padding: 12px 30px;
        border: none;
        border-radius: 12px;
        background: var(--primary);
        color: white;
        font-size: 1.1em;
        cursor: pointer;
        font-family: 'Noto Sans TC', sans-serif;
    }

    /* Kitchen View */
    .orders-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
        margin-top: 30px;
    }

    .order-card {
        background: var(--bg-white);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 20px var(--shadow);
        border-left: 6px solid var(--primary);
        transition: all 0.3s ease;
    }

    .order-card.completed {
        border-left-color: var(--success);
        opacity: 0.7;
    }

    .order-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .order-number-display {
        font-size: 2.5em;
        font-weight: 700;
        color: var(--primary);
        font-family: 'Righteous', cursive;
    }

    .order-time {
        font-size: 0.9em;
        color: var(--text-muted);
    }

    .order-items {
        margin: 15px 0;
    }

    .order-item {
        padding: 8px 0;
        border-bottom: 1px solid var(--border);
    }

    .complete-btn {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 12px;
        background: var(--success);
        color: white;
        font-weight: 700;
        cursor: pointer;
        font-family: 'Noto Sans TC', sans-serif;
        transition: all 0.3s ease;
    }

    .complete-btn:hover {
        background: #45a049;
        transform: translateY(-2px);
    }

    .completed-badge {
        background: var(--success);
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.9em;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-muted);
    }

    .empty-state-icon {
        font-size: 5em;
        margin-bottom: 20px;
        opacity: 0.5;
    }

    /* Statistics Cards */
    .stat-card {
        background: var(--bg-white);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 20px var(--shadow);
        border-left: 6px solid var(--secondary);
    }

    .stat-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
    }

    .stat-emoji {
        font-size: 2.5em;
    }

    .stat-name {
        font-size: 1.1em;
        font-weight: 700;
        color: var(--text-dark);
    }

    .stat-numbers {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid var(--border);
    }

    .stat-count {
        text-align: center;
    }

    .stat-label {
        font-size: 0.85em;
        color: var(--text-muted);
        margin-bottom: 5px;
    }

    .stat-value {
        font-size: 2em;
        font-weight: 700;
        color: var(--primary);
    }

    .stat-max {
        font-size: 1.5em;
        color: var(--text-muted);
    }

    .progress-bar {
        width: 100%;
        height: 10px;
        background: var(--bg-light);
        border-radius: 10px;
        overflow: hidden;
        margin-top: 10px;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--success), var(--secondary));
        transition: width 0.3s ease;
    }

    .progress-fill.warning {
        background: linear-gradient(90deg, var(--secondary), var(--accent));
    }

    .progress-fill.danger {
        background: linear-gradient(90deg, var(--danger), var(--primary));
    }

    /* Settings Cards */
    .settings-card {
        background: var(--bg-white);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 20px var(--shadow);
        border: 2px solid var(--border);
    }

    .settings-input {
        width: 100%;
        padding: 12px;
        font-size: 1.1em;
        border: 2px solid var(--border);
        border-radius: 12px;
        background: var(--bg-light);
        color: var(--text-dark);
        margin-top: 10px;
        font-family: 'Noto Sans TC', sans-serif;
    }

    .settings-input:focus {
        outline: none;
        border-color: var(--primary);
    }

    .hidden {
        display: none !important;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .header h1 {
            font-size: 1.8em;
        }

        .menu-grid {
            grid-template-columns: 1fr;
        }

        .cart-summary {
            position: relative;
            bottom: auto;
            right: auto;
            margin: 20px 0;
        }

        .orders-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
        html:not(.light-mode) {
            --bg-light: #1a1a2e;
            --bg-white: #16213e;
            --text-dark: #eaeaea;
            --text-muted: #a0a0a0;
            --shadow: rgba(0, 0, 0, 0.3);
            --border: #2d3142;
        }
    }
</style>
```

</head>
<body>
    <div class="header">
        <h1>ğŸ´ ç¾é£Ÿç«™ Food Stand</h1>
        <p>æ­¡è¿å…‰è‡¨ï¼Welcome to our delicious world</p>
    </div>

```
<div class="container">
    <div class="view-toggle">
        <button class="toggle-btn active" onclick="switchView('customer')">
            ğŸ‘¥ é¡§å®¢é»é¤ | Customer Order
        </button>
        <button class="toggle-btn" onclick="switchView('kitchen')">
            ğŸ‘¨â€ğŸ³ å»šæˆ¿ç®¡ç† | Kitchen View
        </button>
    </div>

    <!-- Customer View -->
    <div id="customerView">
        <div class="menu-grid" id="menuGrid"></div>

        <div class="cart-summary" id="cartSummary" style="display: none;">
            <h3>ğŸ›’ è³¼ç‰©è»Š | Cart</h3>
            <div id="cartItems"></div>
            <div class="cart-total">
                ç¸½è¨ˆ Total: <span id="cartTotal">0</span> NTD
            </div>
            <button class="submit-order" onclick="submitOrder()">
                âœ… ç¢ºèªè¨‚å–® | Submit Order
            </button>
        </div>
    </div>

    <!-- Kitchen View -->
    <div id="kitchenView" class="hidden">
        <!-- Management Tabs -->
        <div class="view-toggle" style="margin-bottom: 20px;">
            <button class="toggle-btn active" onclick="showKitchenTab('orders')">ğŸ“¦ è¨‚å–® | Orders</button>
            <button class="toggle-btn" onclick="showKitchenTab('statistics')">ğŸ“Š çµ±è¨ˆ | Statistics</button>
            <button class="toggle-btn" onclick="showKitchenTab('settings')">âš™ï¸ è¨­å®š | Settings</button>
        </div>

        <!-- Orders Tab -->
        <div id="ordersTab">
            <!-- Reset Buttons -->
            <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="complete-btn" onclick="clearCompletedOrders()" style="background: var(--secondary);">
                    ğŸ—‘ï¸ æ¸…é™¤å·²å®Œæˆè¨‚å–® | Clear Completed Orders
                </button>
                <button class="complete-btn" onclick="resetAllOrders()" style="background: var(--danger);">
                    â™»ï¸ é‡ç½®æ‰€æœ‰è¨‚å–® | Reset All Orders
                </button>
                <button class="complete-btn" onclick="resetOrderCounter()" style="background: var(--text-muted);">
                    ğŸ”¢ é‡ç½®è¨‚å–®ç·¨è™Ÿ | Reset Order Counter
                </button>
            </div>

            <!-- Pending Orders -->
            <div id="pendingSection">
                <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ”¥ å¾…è™•ç†è¨‚å–® | Pending Orders</h2>
                <div class="orders-grid" id="pendingOrdersGrid"></div>
                <div id="emptyStatePending" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">âœ…</div>
                    <h2>æ‰€æœ‰è¨‚å–®å·²å®Œæˆ | All Orders Completed</h2>
                </div>
            </div>

            <!-- Completed Orders -->
            <div id="completedSection" style="margin-top: 40px;">
                <h2 style="color: var(--success); margin-bottom: 20px;">âœ… å·²å®Œæˆè¨‚å–® | Completed Orders</h2>
                <div class="orders-grid" id="completedOrdersGrid"></div>
                <div id="emptyStateCompleted" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">ğŸ“‹</div>
                    <h2>å°šç„¡å®Œæˆè¨‚å–® | No Completed Orders Yet</h2>
                </div>
            </div>
        </div>

        <!-- Statistics Tab -->
        <div id="statisticsTab" class="hidden">
            <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ“Š éŠ·å”®çµ±è¨ˆ | Sales Statistics</h2>
            <div id="statisticsGrid" class="menu-grid"></div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="hidden">
            <!-- Site Name Settings -->
            <div style="margin-bottom: 30px;">
                <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸª ç«™é»åç¨± | Site Name</h2>
                <div class="settings-card">
                    <label style="font-size: 0.9em; color: var(--text-muted);">è¡¨æƒ…ç¬¦è™Ÿ | Emoji</label>
                    <input type="text" id="siteEmoji" class="settings-input" placeholder="ğŸ´" maxlength="2">

                    <label style="font-size: 0.9em; color: var(--text-muted); margin-top: 10px; display: block;">ä¸­æ–‡åç¨± | Chinese Name</label>
                    <input type="text" id="siteNameCh" class="settings-input" placeholder="ç¾é£Ÿç«™">

                    <label style="font-size: 0.9em; color: var(--text-muted); margin-top: 10px; display: block;">è‹±æ–‡åç¨± | English Name</label>
                    <input type="text" id="siteNameEn" class="settings-input" placeholder="Food Stand">

                    <button class="complete-btn" onclick="saveSiteName()" style="margin-top: 15px;">
                        ğŸ’¾ å„²å­˜åç¨± | Save Name
                    </button>
                </div>
            </div>

            <!-- Color Theme -->
            <div style="margin-bottom: 30px;">
                <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ¨ é¡è‰²ä¸»é¡Œ | Color Theme</h2>
                <div id="colorThemeSelector" class="menu-grid"></div>
            </div>

            <!-- Menu Items Management -->
            <div style="margin-bottom: 30px;">
                <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ½ï¸ èœå–®é …ç›®ç®¡ç† | Menu Items Management</h2>
                <button class="submit-order" onclick="showAddItemModal()" style="max-width: 300px; margin-bottom: 20px;">
                    â• æ–°å¢é …ç›® | Add New Item
                </button>
                <div id="menuManagementGrid" class="menu-grid"></div>
            </div>

            <!-- Extra Options Management -->
            <div style="margin-bottom: 30px;">
                <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ é¡å¤–é¸é …ç®¡ç† | Extra Options Management</h2>
                <button class="submit-order" onclick="showAddExtraOptionModal()" style="max-width: 300px; margin-bottom: 20px;">
                    â• æ–°å¢é¸é … | Add New Option
                </button>
                <div id="extraOptionsGrid" class="menu-grid"></div>
            </div>

            <!-- Inventory Settings -->
            <div style="margin-bottom: 30px;">
                <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ“¦ åº«å­˜è¨­å®š | Inventory Settings</h2>
                <div id="settingsGrid" class="menu-grid"></div>
            </div>

            <!-- Firebase Sync Settings -->
            <div style="margin-bottom: 30px;">
                <h2 style="color: var(--primary); margin-bottom: 20px;">â˜ï¸ Firebase åŒæ­¥ | Firebase Sync</h2>
                <div class="settings-card" style="max-width: 800px;">
                    <p style="margin-bottom: 15px; color: var(--text-muted); font-size: 0.9em;">
                        è«‹å¾ Firebase Console è¤‡è£½æ‚¨çš„è¨­å®š | Please copy your config from Firebase Console
                    </p>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="font-size: 0.9em; color: var(--text-muted);">API Key *</label>
                            <input type="text" id="apiKeyInput" class="settings-input" placeholder="AIzaSyXXXXX...">
                        </div>
                        <div>
                            <label style="font-size: 0.9em; color: var(--text-muted);">Auth Domain</label>
                            <input type="text" id="authDomainInput" class="settings-input" placeholder="your-project.firebaseapp.com">
                        </div>
                        <div>
                            <label style="font-size: 0.9em; color: var(--text-muted);">Database URL *</label>
                            <input type="text" id="databaseURLInput" class="settings-input" placeholder="https://your-project.firebaseio.com">
                        </div>
                        <div>
                            <label style="font-size: 0.9em; color: var(--text-muted);">Project ID</label>
                            <input type="text" id="projectIdInput" class="settings-input" placeholder="your-project">
                        </div>
                        <div>
                            <label style="font-size: 0.9em; color: var(--text-muted);">Storage Bucket</label>
                            <input type="text" id="storageBucketInput" class="settings-input" placeholder="your-project.appspot.com">
                        </div>
                        <div>
                            <label style="font-size: 0.9em; color: var(--text-muted);">Messaging Sender ID</label>
                            <input type="text" id="messagingSenderIdInput" class="settings-input" placeholder="123456789">
                        </div>
                        <div style="grid-column: 1 / -1;">
                            <label style="font-size: 0.9em; color: var(--text-muted);">App ID</label>
                            <input type="text" id="appIdInput" class="settings-input" placeholder="1:123456789:web:xxxxx">
                        </div>
                    </div>

                    <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="complete-btn" onclick="saveFirebaseConfig()">
                            ğŸ’¾ é€£æ¥Firebase | Connect Firebase
                        </button>
                        <button class="complete-btn" onclick="loadFromFirebase()" style="background: var(--secondary);">
                            â¬‡ï¸ å¾Firebaseè¼‰å…¥ | Load from Firebase
                        </button>
                        <button class="complete-btn" onclick="saveToFirebase()" style="background: var(--primary);">
                            â¬†ï¸ å„²å­˜åˆ°Firebase | Save to Firebase
                        </button>
                        <button class="complete-btn" onclick="enableRealtimeSync()" style="background: var(--success);">
                            ğŸ”„ å•Ÿç”¨å³æ™‚åŒæ­¥ | Enable Real-time Sync
                        </button>
                    </div>
                    <div id="syncStatus" style="margin-top: 15px; padding: 10px; border-radius: 8px; display: none;"></div>

                    <details style="margin-top: 20px; padding: 15px; background: var(--bg-light); border-radius: 8px;">
                        <summary style="cursor: pointer; font-weight: 700; color: var(--primary);">ğŸ“– å¦‚ä½•è¨­å®š Firebase | How to Setup Firebase</summary>
                        <ol style="margin-top: 15px; line-height: 1.8; color: var(--text-dark);">
                            <li>å‰å¾€ <a href="https://console.firebase.google.com/" target="_blank" style="color: var(--primary);">Firebase Console</a></li>
                            <li>å»ºç«‹æ–°å°ˆæ¡ˆæˆ–é¸æ“‡ç¾æœ‰å°ˆæ¡ˆ | Create new project or select existing</li>
                            <li>é»æ“Šå·¦å´ "Realtime Database" â†’ å»ºç«‹è³‡æ–™åº« (æ¸¬è©¦æ¨¡å¼) | Click "Realtime Database" â†’ Create Database (test mode)</li>
                            <li>é»æ“Šå°ˆæ¡ˆè¨­å®š (é½’è¼ªåœ–ç¤º) â†’ å‘ä¸‹æ»¾å‹•åˆ° "æ‚¨çš„æ‡‰ç”¨ç¨‹å¼" | Click Project Settings (gear icon) â†’ Scroll to "Your apps"</li>
                            <li>é»æ“Šç¶²é åœ–ç¤º &lt;/&gt; æ–°å¢æ‡‰ç”¨ç¨‹å¼ | Click web icon &lt;/&gt; to add web app</li>
                            <li>è¤‡è£½ firebaseConfig ç‰©ä»¶ä¸­çš„å€¼åˆ°ä¸Šæ–¹æ¬„ä½ | Copy values from firebaseConfig object to fields above</li>
                            <li>é»æ“Š "é€£æ¥Firebase" æŒ‰éˆ• | Click "Connect Firebase" button</li>
                        </ol>
                    </details>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Order Confirmation Modal -->
<div class="modal" id="orderModal">
    <div class="modal-content">
        <h2>âœ… è¨‚å–®å·²ç¢ºèªï¼</h2>
        <h3>Order Confirmed!</h3>
        <div style="margin: 20px 0;">
            <p style="font-size: 1.2em; margin-bottom: 10px;">æ‚¨çš„å–é¤è™Ÿç¢¼ | Your Order Number:</p>
            <div class="order-number" id="modalOrderNumber"></div>
        </div>
        <p style="color: var(--text-muted);">è«‹ç­‰å€™å«è™Ÿ | Please wait for your number</p>
        <button class="modal-close" onclick="closeModal()">
            é—œé–‰ | Close
        </button>
    </div>
</div>

<!-- Password Modal -->
<div class="modal" id="passwordModal">
    <div class="modal-content">
        <h2>ğŸ”’ å»šæˆ¿ç®¡ç†ç™»å…¥</h2>
        <h3>Kitchen Access Login</h3>
        <div style="margin: 30px 0;">
            <input type="password" id="passwordInput"
                placeholder="è«‹è¼¸å…¥å¯†ç¢¼ | Enter password"
                style="width: 100%; padding: 15px; font-size: 1.1em; border: 2px solid var(--border); border-radius: 12px; background: var(--bg-light); color: var(--text-dark);">
            <div id="passwordError" style="color: var(--danger); margin-top: 10px; display: none;">
                âŒ å¯†ç¢¼éŒ¯èª¤ | Incorrect password
            </div>
        </div>
        <button class="modal-close" onclick="verifyPassword()">
            ç™»å…¥ | Login
        </button>
        <button class="modal-close" onclick="closePasswordModal()" style="background: var(--text-muted); margin-top: 10px;">
            å–æ¶ˆ | Cancel
        </button>
    </div>
</div>

<!-- Add/Edit Item Modal -->
<div class="modal" id="itemModal">
    <div class="modal-content" style="max-width: 600px;">
        <h2 id="itemModalTitle">â• æ–°å¢èœå–®é …ç›® | Add Menu Item</h2>
        <div style="margin: 20px 0; text-align: left;">
            <input type="hidden" id="editItemId">
            <label style="font-size: 0.9em; color: var(--text-muted);">è¡¨æƒ…ç¬¦è™Ÿ | Emoji</label>
            <input type="text" id="itemEmoji" class="settings-input" placeholder="ğŸ”" maxlength="2">

            <label style="font-size: 0.9em; color: var(--text-muted); margin-top: 10px; display: block;">ä¸­æ–‡åç¨± | Chinese Name</label>
            <input type="text" id="itemNameCh" class="settings-input" placeholder="ç¾å‘³æ¼¢å ¡">

            <label style="font-size: 0.9em; color: var(--text-muted); margin-top: 10px; display: block;">è‹±æ–‡åç¨± | English Name</label>
            <input type="text" id="itemNameEn" class="settings-input" placeholder="Delicious Burger">

            <label style="font-size: 0.9em; color: var(--text-muted); margin-top: 10px; display: block;">åƒ¹æ ¼ | Price (NTD)</label>
            <input type="number" id="itemPrice" class="settings-input" placeholder="100" min="0">

            <label style="font-size: 0.9em; color: var(--text-muted); margin-top: 10px; display: block;">æœ€å¤§åº«å­˜ | Max Inventory</label>
            <input type="number" id="itemMaxInventory" class="settings-input" placeholder="50" min="0">
        </div>
        <button class="modal-close" onclick="saveItem()">
            ğŸ’¾ å„²å­˜ | Save
        </button>
        <button class="modal-close" onclick="closeItemModal()" style="background: var(--text-muted); margin-top: 10px;">
            å–æ¶ˆ | Cancel
        </button>
    </div>
</div>

<!-- Add/Edit Extra Option Modal -->
<div class="modal" id="extraOptionModal">
    <div class="modal-content" style="max-width: 600px;">
        <h2 id="extraOptionModalTitle">â• æ–°å¢é¡å¤–é¸é … | Add Extra Option</h2>
        <div style="margin: 20px 0; text-align: left;">
            <input type="hidden" id="editExtraOptionId">
            <label style="font-size: 0.9em; color: var(--text-muted);">ä¸­æ–‡åç¨± | Chinese Name</label>
            <input type="text" id="extraOptionNameCh" class="settings-input" placeholder="åŠ è³¼é£²æ–™">

            <label style="font-size: 0.9em; color: var(--text-muted); margin-top: 10px; display: block;">è‹±æ–‡åç¨± | English Name</label>
            <input type="text" id="extraOptionNameEn" class="settings-input" placeholder="Add Drink">

            <label style="font-size: 0.9em; color: var(--text-muted); margin-top: 10px; display: block;">åƒ¹æ ¼ | Price (NTD)</label>
            <input type="number" id="extraOptionPrice" class="settings-input" placeholder="15" min="0">
        </div>
        <button class="modal-close" onclick="saveExtraOption()">
            ğŸ’¾ å„²å­˜ | Save
        </button>
        <button class="modal-close" onclick="closeExtraOptionModal()" style="background: var(--text-muted); margin-top: 10px;">
            å–æ¶ˆ | Cancel
        </button>
    </div>
</div>

<script>
let firebaseApp;
let db;
let realtimeSyncEnabled = false;

function saveFirebaseConfig() {
    const config = {
        apiKey: document.getElementById("apiKeyInput").value,
        authDomain: document.getElementById("authDomainInput").value,
        databaseURL: document.getElementById("databaseURLInput").value,
        projectId: document.getElementById("projectIdInput").value,
        storageBucket: document.getElementById("storageBucketInput").value,
        messagingSenderId: document.getElementById("messagingSenderIdInput").value,
        appId: document.getElementById("appIdInput").value,
    };

    try {
        firebaseApp = firebase.initializeApp(config);
        db = firebase.database();
        console.log("Firebase initialized successfully!");
        document.getElementById("syncStatus").style.display = "block";
        document.getElementById("syncStatus").innerText = "âœ… Firebase connected";
    } catch (err) {
        console.error("Firebase init failed:", err);
        document.getElementById("syncStatus").style.display = "block";
        document.getElementById("syncStatus").innerText = "âŒ Firebase init failed";
    }
}

function enableRealtimeSync() {
    if (!db) {
        console.error("Firebase not initialized");
        return;
    }

    realtimeSyncEnabled = true;
    listenForOrders();
    document.getElementById("syncStatus").innerText = "ğŸ”„ Real-time sync enabled";
}

function listenForOrders() {
    if (!realtimeSyncEnabled) return;

    db.ref("orders/pending").on("value", snapshot => {
        const orders = snapshot.val() || {};
        renderPendingOrders(orders);
    });

    db.ref("orders/completed").on("value", snapshot => {
        const orders = snapshot.val() || {};
        renderCompletedOrders(orders);
    });
}

function renderPendingOrders(orders) {
    const grid = document.getElementById("pendingOrdersGrid");
    const emptyState = document.getElementById("emptyStatePending");
    grid.innerHTML = "";

    const entries = Object.entries(orders);
    if (entries.length === 0) {
        emptyState.style.display = "block";
        return;
    }

    emptyState.style.display = "none";
    entries.forEach(([id, order]) => {
        grid.innerHTML += `
            <div class="order-card">
                <div class="order-card-header">
                    <div class="order-number-display">#${order.number}</div>
                    <div class="order-time">${order.time}</div>
                </div>
                <div class="order-items">
                    ${order.items.map(i => `<div class="order-item">${i}</div>`).join("")}
                </div>
                <button class="complete-btn" onclick="markOrderCompleted('${id}')">å®Œæˆ | Complete</button>
            </div>
        `;
    });
}

function renderCompletedOrders(orders) {
    const grid = document.getElementById("completedOrdersGrid");
    const emptyState = document.getElementById("emptyStateCompleted");
    grid.innerHTML = "";

    const entries = Object.entries(orders);
    if (entries.length === 0) {
        emptyState.style.display = "block";
        return;
    }

    emptyState.style.display = "none";
    entries.forEach(([id, order]) => {
        grid.innerHTML += `
            <div class="order-card completed">
                <div class="order-card-header">
                    <div class="order-number-display">#${order.number}</div>
                    <div class="order-time">${order.time}</div>
                </div>
                <div class="order-items">
                    ${order.items.map(i => `<div class="order-item">${i}</div>`).join("")}
                </div>
                <div class="completed-badge">âœ… Completed</div>
            </div>
        `;
    });
}

function markOrderCompleted(orderId) {
    const orderRef = db.ref(`orders/pending/${orderId}`);
    orderRef.once("value").then(snapshot => {
        const orderData = snapshot.val();
        if (orderData) {
            db.ref(`orders/completed/${orderId}`).set(orderData);
            orderRef.remove();
        }
    });
}

    // Menu items data
    const menuItems = [
        {
            id: 1,
            emoji: 'ğŸ¥˜',
            nameCh: 'å’–å“©é¦™è…¸é¤ç›’',
            nameEn: 'Curry Sausage Meal Box',
            price: 100,
            canAddDrink: true
        },
        {
            id: 2,
            emoji: 'ğŸŒ­',
            nameCh: 'ç¾å¼ç†±ç‹—å ¡',
            nameEn: 'American Hot Dog',
            price: 75,
            canAddDrink: true
        },
        {
            id: 3,
            emoji: 'ğŸ',
            nameCh: 'å¾·åœ‹å¤–å©†è˜‹æœè›‹ç³•',
            nameEn: 'German Grandma\'s Apple Cake',
            price: 85,
            canAddDrink: true
        },
        {
            id: 4,
            emoji: 'ğŸŠ',
            nameCh: 'è¾²èŠé‡‘æ¡”ç³–æ¼¿æ°£æ³¡æ°´',
            nameEn: 'Farm Kumquat Syrup Sparkling Water',
            price: 35,
            canAddDrink: false
        }
    ];

    // Cart state (in-memory storage for iframe compatibility)
    let cart = [];
    let orderCounter = 0;
    let orders = [];
    let isKitchenAuthenticated = false;
    const KITCHEN_PASSWORD = '1234';

    // Max inventory settings (configurable)
    let maxInventory = {
        1: 50,
        2: 50,
        3: 30,
        4: 100
    };

    // Firebase config
    let firebaseConfig = {
        apiKey: "AIzaSyD7cWCX1_GQ1V0SCWEo5tAtmNWYX4DGwIg",
        authDomain: "german-sausage.firebaseapp.com",
        databaseURL: "https://german-sausage-default-rtdb.firebaseio.com",
        projectId: "german-sausage",
        storageBucket: "german-sausage.firebasestorage.app",
        messagingSenderId: "951839734578",
        appId: "1:951839734578:web:d0a8bf70520460cd97b52b",
        measurementId: "G-V14K88QR24",
        configured: false
    };

    let firebaseDb = null;

    // Color themes
    const colorThemes = {
        orange: {
            name: 'æ©™è‰²ä¸»é¡Œ | Orange',
            primary: '#FF6B35',
            secondary: '#F7931E',
            accent: '#FDC830'
        },
        blue: {
            name: 'è—è‰²ä¸»é¡Œ | Blue',
            primary: '#3B82F6',
            secondary: '#60A5FA',
            accent: '#93C5FD'
        },
        green: {
            name: 'ç¶ è‰²ä¸»é¡Œ | Green',
            primary: '#10B981',
            secondary: '#34D399',
            accent: '#6EE7B7'
        },
        purple: {
            name: 'ç´«è‰²ä¸»é¡Œ | Purple',
            primary: '#8B5CF6',
            secondary: '#A78BFA',
            accent: '#C4B5FD'
        },
        red: {
            name: 'ç´…è‰²ä¸»é¡Œ | Red',
            primary: '#EF4444',
            secondary: '#F87171',
            accent: '#FCA5A5'
        }
    };

    let currentTheme = 'orange';

    // Site name settings
    let siteName = {
        chinese: 'ç¾é£Ÿç«™',
        english: 'Food Stand',
        emoji: 'ğŸ´'
    };

    // Extra options (like add drink)
    let extraOptions = [
        {
            id: 1,
            nameCh: 'åŠ è³¼é£²æ–™',
            nameEn: 'Add Drink',
            price: 15
        }
    ];

    let nextItemId = 5;
    let nextExtraOptionId = 2;

    // Initialize
    renderMenu();
    updateCartDisplay();
    updateSiteName();
    autoInitializeFirebase();

    // Dark mode detection
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
    }
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
        if (event.matches) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    });

    // Site name functions
    function updateSiteName() {
        const header = document.querySelector('.header h1');
        if (header) {
            header.innerHTML = `${siteName.emoji} ${siteName.chinese} ${siteName.english}`;
        }
    }

    function saveSiteName() {
        siteName.emoji = document.getElementById('siteEmoji').value.trim() || 'ğŸ´';
        siteName.chinese = document.getElementById('siteNameCh').value.trim() || 'ç¾é£Ÿç«™';
        siteName.english = document.getElementById('siteNameEn').value.trim() || 'Food Stand';
        
        updateSiteName();
        saveToFirebase();
        showSyncStatus('âœ… ç«™é»åç¨±å·²æ›´æ–° | Site name updated', 'success');
    }

    function loadSiteNameToSettings() {
        if (document.getElementById('siteEmoji')) {
            document.getElementById('siteEmoji').value = siteName.emoji;
            document.getElementById('siteNameCh').value = siteName.chinese;
            document.getElementById('siteNameEn').value = siteName.english;
        }
    }

    function renderMenu() {
        const menuGrid = document.getElementById('menuGrid');
        menuGrid.innerHTML = menuItems.map(item => `
            <div class="menu-item">
                <div class="item-header">
                    <div class="item-emoji">${item.emoji}</div>
                    <div class="item-info">
                        <h3>${item.nameCh}</h3>
                        <div class="english">${item.nameEn}</div>
                    </div>
                </div>
                <div class="item-price">${item.price} NTD</div>

                ${item.canAddDrink ? `
                    <div class="add-drink-option">
                        <input type="checkbox" id="drink-${item.id}" onchange="updateItemTotal(${item.id})">
                        <label for="drink-${item.id}">
                            åŠ è³¼é£²æ–™ +15 NTD<br>
                            <span style="font-size: 0.9em; color: var(--text-muted);">Add Drink +15 NTD</span>
                        </label>
                    </div>
                ` : ''}

                <div class="quantity-control">
                    <button class="qty-btn" onclick="changeQuantity(${item.id}, -1)">-</button>
                    <div class="qty-display" id="qty-${item.id}">0</div>
                    <button class="qty-btn" onclick="changeQuantity(${item.id}, 1)">+</button>
                </div>

                <button class="add-to-cart" onclick="addToCart(${item.id})">
                    åŠ å…¥è³¼ç‰©è»Š | Add to Cart
                </button>
            </div>
        `).join('');
    }

    function changeQuantity(itemId, delta) {
        const qtyDisplay = document.getElementById(`qty-${itemId}`);
        let current = parseInt(qtyDisplay.textContent);
        current = Math.max(0, current + delta);
        qtyDisplay.textContent = current;
        updateItemTotal(itemId);
    }

    function updateItemTotal(itemId) {
        // This could be extended to show live total per item
    }

    function addToCart(itemId) {
        const item = menuItems.find(i => i.id === itemId);
        const qty = parseInt(document.getElementById(`qty-${itemId}`).textContent);

        if (qty === 0) return;

        const addDrink = item.canAddDrink ? document.getElementById(`drink-${itemId}`).checked : false;
        const totalPrice = (item.price + (addDrink ? 15 : 0)) * qty;

        cart.push({
            ...item,
            quantity: qty,
            addDrink: addDrink,
            totalPrice: totalPrice
        });

        // Reset quantity
        document.getElementById(`qty-${itemId}`).textContent = '0';
        if (item.canAddDrink) {
            document.getElementById(`drink-${itemId}`).checked = false;
        }

        updateCartDisplay();
    }

    function updateCartDisplay() {
        const cartSummary = document.getElementById('cartSummary');
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');

        if (cart.length === 0) {
            cartSummary.style.display = 'none';
            return;
        }

        cartSummary.style.display = 'block';

        cartItems.innerHTML = cart.map((item, index) => `
            <div class="cart-item">
                ${item.emoji} ${item.nameCh} x${item.quantity}
                ${item.addDrink ? '<br>ã€€ã€€+ é£²æ–™ (Drink)' : ''}
                <br>
                ã€€ã€€${item.totalPrice} NTD
            </div>
        `).join('');

        const total = cart.reduce((sum, item) => sum + item.totalPrice, 0);
        cartTotal.textContent = total;
    }

    function submitOrder() {
        if (cart.length === 0) return;

        orderCounter++;
        const order = {
            orderNumber: orderCounter,
            items: [...cart],
            total: cart.reduce((sum, item) => sum + item.totalPrice, 0),
            timestamp: new Date().toISOString(),
            completed: false
        };

        orders.unshift(order);
        saveToFirebase();

        document.getElementById('modalOrderNumber').textContent = orderCounter;
        document.getElementById('orderModal').classList.add('show');

        cart = [];
        updateCartDisplay();
    }

    function closeModal() {
        document.getElementById('orderModal').classList.remove('show');
    }

    function switchView(view) {
        const customerView = document.getElementById('customerView');
        const kitchenView = document.getElementById('kitchenView');
        const buttons = document.querySelectorAll('.toggle-btn');

        if (view === 'customer') {
            customerView.classList.remove('hidden');
            kitchenView.classList.add('hidden');
            buttons[0].classList.add('active');
            buttons[1].classList.remove('active');
        } else {
            if (!isKitchenAuthenticated) {
                document.getElementById('passwordModal').classList.add('show');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordError').style.display = 'none';
                return;
            }

            customerView.classList.add('hidden');
            kitchenView.classList.remove('hidden');
            buttons[0].classList.remove('active');
            buttons[1].classList.add('active');
            renderKitchenView();
        }
    }

    function verifyPassword() {
        const input = document.getElementById('passwordInput');
        const error = document.getElementById('passwordError');

        if (input.value === KITCHEN_PASSWORD) {
            isKitchenAuthenticated = true;
            closePasswordModal();
            switchView('kitchen');
        } else {
            error.style.display = 'block';
            input.value = '';
            input.focus();
        }
    }

    function closePasswordModal() {
        document.getElementById('passwordModal').classList.remove('show');
        if (!isKitchenAuthenticated) {
            const buttons = document.querySelectorAll('.toggle-btn');
            buttons[0].classList.add('active');
            buttons[1].classList.remove('active');
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const passwordInput = document.getElementById('passwordInput');
        if (passwordInput) {
            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    verifyPassword();
                }
            });
        }
    });

    function renderKitchenView() {
        renderStatistics();
        renderSettings();
        renderPendingOrders();
        renderCompletedOrders();
    }

    function calculateItemStats() {
        const stats = {};
        menuItems.forEach(item => {
            stats[item.id] = 0;
        });

        orders.forEach(order => {
            order.items.forEach(item => {
                stats[item.id] += item.quantity;
            });
        });

        return stats;
    }

    function renderStatistics() {
        const statsGrid = document.getElementById('statisticsGrid');
        const stats = calculateItemStats();

        statsGrid.innerHTML = menuItems.map(item => {
            const sold = stats[item.id];
            const max = maxInventory[item.id];
            const percentage = (sold / max) * 100;
            let progressClass = '';

            if (percentage >= 90) {
                progressClass = 'danger';
            } else if (percentage >= 70) {
                progressClass = 'warning';
            }

            return `
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-emoji">${item.emoji}</div>
                        <div>
                            <div class="stat-name">${item.nameCh}</div>
                            <div style="font-size: 0.85em; color: var(--text-muted);">${item.nameEn}</div>
                        </div>
                    </div>
                    <div class="stat-numbers">
                        <div class="stat-count">
                            <div class="stat-label">å·²å”®å‡º | Sold</div>
                            <div class="stat-value">${sold}</div>
                        </div>
                        <div style="font-size: 1.5em; color: var(--text-muted);">/</div>
                        <div class="stat-count">
                            <div class="stat-label">æœ€å¤§é‡ | Max</div>
                            <div class="stat-max">${max}</div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill ${progressClass}" style="width: ${Math.min(percentage, 100)}%"></div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderSettings() {
        const settingsGrid = document.getElementById('settingsGrid');

        settingsGrid.innerHTML = menuItems.map(item => `
            <div class="settings-card">
                <div class="stat-header">
                    <div class="stat-emoji">${item.emoji}</div>
                    <div>
                        <div class="stat-name">${item.nameCh}</div>
                        <div style="font-size: 0.85em; color: var(--text-muted);">${item.nameEn}</div>
                    </div>
                </div>
                <label style="font-size: 0.9em; color: var(--text-muted);">
                    æœ€å¤§åº«å­˜é‡ | Max Inventory
                </label>
                <input type="number" class="settings-input" value="${maxInventory[item.id]}"
                    onchange="updateMaxInventory(${item.id}, this.value)" min="0">
            </div>
        `).join('');
    }

    function updateMaxInventory(itemId, value) {
        maxInventory[itemId] = parseInt(value) || 0;
        renderStatistics();
    }

    function renderPendingOrders() {
        const pendingGrid = document.getElementById('pendingOrdersGrid');
        const emptyState = document.getElementById('emptyStatePending');

        const pendingOrders = orders.filter(o => !o.completed);

        if (pendingOrders.length === 0) {
            pendingGrid.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }

        emptyState.style.display = 'none';

        pendingGrid.innerHTML = pendingOrders.map(order => `
            <div class="order-card">
                <div class="order-card-header">
                    <div class="order-number-display">#${order.orderNumber}</div>
                    <div class="order-time">
                        ${new Date(order.timestamp).toLocaleTimeString('zh-TW', {
                            hour: '2-digit',
                            minute: '2-digit'
                        })}
                    </div>
                </div>

                <div class="order-items">
                    ${order.items.map(item => `
                        <div class="order-item">
                            ${item.emoji} ${item.nameCh} x${item.quantity}
                            ${item.addDrink ? '<br>ã€€ã€€+ é£²æ–™ (Drink)' : ''}
                        </div>
                    `).join('')}
                </div>

                <div class="cart-total" style="font-size: 1.3em;">
                    ç¸½è¨ˆ Total: ${order.total} NTD
                </div>

                <button class="complete-btn" onclick="completeOrder(${order.orderNumber})">
                    âœ… å®Œæˆè¨‚å–® | Complete Order
                </button>
            </div>
        `).join('');
    }

    function renderCompletedOrders() {
        const completedGrid = document.getElementById('completedOrdersGrid');
        const emptyState = document.getElementById('emptyStateCompleted');

        const completedOrders = orders.filter(o => o.completed);

        if (completedOrders.length === 0) {
            completedGrid.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }

        emptyState.style.display = 'none';

        completedGrid.innerHTML = completedOrders.map(order => `
            <div class="order-card completed">
                <div class="order-card-header">
                    <div class="order-number-display">#${order.orderNumber}</div>
                    <div class="order-time">
                        ${new Date(order.timestamp).toLocaleTimeString('zh-TW', {
                            hour: '2-digit',
                            minute: '2-digit'
                        })}
                    </div>
                </div>

                <div class="order-items">
                    ${order.items.map(item => `
                        <div class="order-item">
                            ${item.emoji} ${item.nameCh} x${item.quantity}
                            ${item.addDrink ? '<br>ã€€ã€€+ é£²æ–™ (Drink)' : ''}
                        </div>
                    `).join('')}
                </div>

                <div class="cart-total" style="font-size: 1.3em;">
                    ç¸½è¨ˆ Total: ${order.total} NTD
                </div>

                <div class="completed-badge">âœ… å·²å®Œæˆ Completed</div>
            </div>
        `).join('');
    }

    function completeOrder(orderNumber) {
        const order = orders.find(o => o.orderNumber === orderNumber);
        if (order) {
            order.completed = true;
            
            // Update UI immediately
            renderPendingOrders();
            renderCompletedOrders();
            renderStatistics();
            
            // Then sync to Firebase
            saveToFirebase();
        }
    }

    setInterval(() => {
        const kitchenView = document.getElementById('kitchenView');
        if (!kitchenView.classList.contains('hidden')) {
            renderKitchenView();
        }
    }, 10000);

    function showKitchenTab(tab) {
        const tabs = ['ordersTab', 'statisticsTab', 'settingsTab'];
        const buttons = document.querySelectorAll('#kitchenView .view-toggle .toggle-btn');

        tabs.forEach((t, index) => {
            const element = document.getElementById(t);
            if (t === tab + 'Tab') {
                element.classList.remove('hidden');
                buttons[index].classList.add('active');
            } else {
                element.classList.add('hidden');
                buttons[index].classList.remove('active');
            }
        });

        if (tab === 'settings') {
            renderColorThemeSelector();
            renderMenuManagement();
            renderExtraOptionsManagement();
            renderSettings();
            loadFirebaseConfigFromMemory();
            loadSiteNameToSettings();
        }
    }

    function renderColorThemeSelector() {
        const selector = document.getElementById('colorThemeSelector');
        selector.innerHTML = Object.keys(colorThemes).map(themeKey => {
            const theme = colorThemes[themeKey];
            return `
                <div class="settings-card" onclick="applyTheme('${themeKey}')" style="cursor: pointer; ${currentTheme === themeKey ? 'border: 3px solid var(--primary);' : ''}">
                    <h3 style="margin-bottom: 15px;">${theme.name}</h3>
                    <div style="display: flex; gap: 10px;">
                        <div style="width: 60px; height: 60px; border-radius: 12px; background: ${theme.primary};"></div>
                        <div style="width: 60px; height: 60px; border-radius: 12px; background: ${theme.secondary};"></div>
                        <div style="width: 60px; height: 60px; border-radius: 12px; background: ${theme.accent};"></div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function applyTheme(themeKey) {
        currentTheme = themeKey;
        const theme = colorThemes[themeKey];
        const root = document.documentElement;

        root.style.setProperty('--primary', theme.primary);
        root.style.setProperty('--secondary', theme.secondary);
        root.style.setProperty('--accent', theme.accent);

        renderColorThemeSelector();
        saveToFirebase();
    }

    function renderMenuManagement() {
        const grid = document.getElementById('menuManagementGrid');
        grid.innerHTML = menuItems.map(item => `
            <div class="settings-card">
                <div class="stat-header">
                    <div class="stat-emoji">${item.emoji}</div>
                    <div>
                        <div class="stat-name">${item.nameCh}</div>
                        <div style="font-size: 0.85em; color: var(--text-muted);">${item.nameEn}</div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <div style="font-size: 1.3em; color: var(--secondary); font-weight: 700;">${item.price} NTD</div>
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="complete-btn" onclick="editItem(${item.id})" style="flex: 1; background: var(--secondary);">
                        âœï¸ ç·¨è¼¯ | Edit
                    </button>
                    <button class="complete-btn" onclick="deleteItem(${item.id})" style="flex: 1; background: var(--danger);">
                        ğŸ—‘ï¸ åˆªé™¤ | Delete
                    </button>
                </div>
            </div>
        `).join('');
    }

    function showAddItemModal() {
        document.getElementById('itemModalTitle').textContent = 'â• æ–°å¢èœå–®é …ç›® | Add Menu Item';
        document.getElementById('editItemId').value = '';
        document.getElementById('itemEmoji').value = '';
        document.getElementById('itemNameCh').value = '';
        document.getElementById('itemNameEn').value = '';
        document.getElementById('itemPrice').value = '';
        document.getElementById('itemMaxInventory').value = '50';
        document.getElementById('itemModal').classList.add('show');
    }

    function editItem(itemId) {
        const item = menuItems.find(i => i.id === itemId);
        if (!item) return;

        document.getElementById('itemModalTitle').textContent = 'âœï¸ ç·¨è¼¯èœå–®é …ç›® | Edit Menu Item';
        document.getElementById('editItemId').value = item.id;
        document.getElementById('itemEmoji').value = item.emoji;
        document.getElementById('itemNameCh').value = item.nameCh;
        document.getElementById('itemNameEn').value = item.nameEn;
        document.getElementById('itemPrice').value = item.price;
        document.getElementById('itemMaxInventory').value = maxInventory[item.id] || 50;
        document.getElementById('itemModal').classList.add('show');
    }

    function saveItem() {
        const editId = document.getElementById('editItemId').value;
        const emoji = document.getElementById('itemEmoji').value.trim();
        const nameCh = document.getElementById('itemNameCh').value.trim();
        const nameEn = document.getElementById('itemNameEn').value.trim();
        const price = parseInt(document.getElementById('itemPrice').value) || 0;
        const maxInv = parseInt(document.getElementById('itemMaxInventory').value) || 50;

        if (!emoji || !nameCh || !nameEn || price <= 0) {
            showSyncStatus('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ | Please fill all fields', 'error');
            return;
        }

        if (editId) {
            const item = menuItems.find(i => i.id === parseInt(editId));
            if (item) {
                item.emoji = emoji;
                item.nameCh = nameCh;
                item.nameEn = nameEn;
                item.price = price;
                maxInventory[item.id] = maxInv;
            }
        } else {
            const newItem = {
                id: nextItemId++,
                emoji,
                nameCh,
                nameEn,
                price,
                canAddDrink: true
            };
            menuItems.push(newItem);
            maxInventory[newItem.id] = maxInv;
        }

        closeItemModal();
        renderMenu();
        renderMenuManagement();
        renderSettings();
        renderStatistics();
        saveToFirebase();
    }

    function deleteItem(itemId) {
        showConfirmDialog(
            'ç¢ºå®šè¦åˆªé™¤æ­¤é …ç›®å—ï¼Ÿ| Are you sure you want to delete this item?',
            () => {
                const index = menuItems.findIndex(i => i.id === itemId);
                if (index !== -1) {
                    menuItems.splice(index, 1);
                    delete maxInventory[itemId];
                    renderMenu();
                    renderMenuManagement();
                    renderStatistics();
                    saveToFirebase();
                }
            }
        );
    }

    function closeItemModal() {
        document.getElementById('itemModal').classList.remove('show');
    }

    function renderExtraOptionsManagement() {
        const grid = document.getElementById('extraOptionsGrid');
        grid.innerHTML = extraOptions.map(option => `
            <div class="settings-card">
                <div>
                    <div class="stat-name">${option.nameCh}</div>
                    <div style="font-size: 0.85em; color: var(--text-muted);">${option.nameEn}</div>
                </div>
                <div style="margin-top: 15px;">
                    <div style="font-size: 1.3em; color: var(--secondary); font-weight: 700;">+${option.price} NTD</div>
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="complete-btn" onclick="editExtraOption(${option.id})" style="flex: 1; background: var(--secondary);">
                        âœï¸ ç·¨è¼¯ | Edit
                    </button>
                    <button class="complete-btn" onclick="deleteExtraOption(${option.id})" style="flex: 1; background: var(--danger);">
                        ğŸ—‘ï¸ åˆªé™¤ | Delete
                    </button>
                </div>
            </div>
        `).join('');
    }

    function showAddExtraOptionModal() {
        document.getElementById('extraOptionModalTitle').textContent = 'â• æ–°å¢é¡å¤–é¸é … | Add Extra Option';
        document.getElementById('editExtraOptionId').value = '';
        document.getElementById('extraOptionNameCh').value = '';
        document.getElementById('extraOptionNameEn').value = '';
        document.getElementById('extraOptionPrice').value = '';
        document.getElementById('extraOptionModal').classList.add('show');
    }

    function editExtraOption(optionId) {
        const option = extraOptions.find(o => o.id === optionId);
        if (!option) return;

        document.getElementById('extraOptionModalTitle').textContent = 'âœï¸ ç·¨è¼¯é¡å¤–é¸é … | Edit Extra Option';
        document.getElementById('editExtraOptionId').value = option.id;
        document.getElementById('extraOptionNameCh').value = option.nameCh;
        document.getElementById('extraOptionNameEn').value = option.nameEn;
        document.getElementById('extraOptionPrice').value = option.price;
        document.getElementById('extraOptionModal').classList.add('show');
    }

    function saveExtraOption() {
        const editId = document.getElementById('editExtraOptionId').value;
        const nameCh = document.getElementById('extraOptionNameCh').value.trim();
        const nameEn = document.getElementById('extraOptionNameEn').value.trim();
        const price = parseInt(document.getElementById('extraOptionPrice').value) || 0;

        if (!nameCh || !nameEn || price <= 0) {
            showSyncStatus('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ | Please fill all fields', 'error');
            return;
        }

        if (editId) {
            const option = extraOptions.find(o => o.id === parseInt(editId));
            if (option) {
                option.nameCh = nameCh;
                option.nameEn = nameEn;
                option.price = price;
            }
        } else {
            extraOptions.push({
                id: nextExtraOptionId++,
                nameCh,
                nameEn,
                price
            });
        }

        closeExtraOptionModal();
        renderExtraOptionsManagement();
        saveToFirebase();
    }

    function deleteExtraOption(optionId) {
        showConfirmDialog(
            'ç¢ºå®šè¦åˆªé™¤æ­¤é¸é …å—ï¼Ÿ| Are you sure you want to delete this option?',
            () => {
                const index = extraOptions.findIndex(o => o.id === optionId);
                if (index !== -1) {
                    extraOptions.splice(index, 1);
                    renderExtraOptionsManagement();
                    saveToFirebase();
                }
            }
        );
    }

    function closeExtraOptionModal() {
        document.getElementById('extraOptionModal').classList.remove('show');
    }

    function showConfirmDialog(message, onConfirm) {
        const modal = document.createElement('div');
        modal.className = 'modal show';
        modal.innerHTML = `
            <div class="modal-content">
                <p style="font-size: 1.1em; margin-bottom: 20px;">${message}</p>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="modal-close" style="background: var(--text-muted);" onclick="this.closest('.modal').remove()">
                        å–æ¶ˆ | Cancel
                    </button>
                    <button class="modal-close" onclick="this.closest('.modal').remove(); (${onConfirm})()">
                        ç¢ºèª | Confirm
                    </button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);

        modal.querySelector('button:last-child').onclick = () => {
            modal.remove();
            onConfirm();
        };
    }

    function showSyncStatus(message, type = 'success') {
        const statusDiv = document.getElementById('syncStatus');
        statusDiv.style.display = 'block';
        statusDiv.style.background = type === 'success' ? 'var(--success)' : 'var(--danger)';
        statusDiv.style.color = 'white';
        statusDiv.textContent = message;

        setTimeout(() => {
            statusDiv.style.display = 'none';
        }, 3000);
    }

    function autoInitializeFirebase() {
        if (firebaseConfig.apiKey && firebaseConfig.databaseURL) {
            console.log('ğŸ”¥ Firebase config found, auto-initializing...');
            initializeFirebase();
        } else {
            console.log('â„¹ï¸ No Firebase config found. Configure in Kitchen Settings.');
        }
    }

    function loadFirebaseConfigFromMemory() {
        if (document.getElementById('apiKeyInput')) {
            document.getElementById('apiKeyInput').value = firebaseConfig.apiKey || '';
            document.getElementById('authDomainInput').value = firebaseConfig.authDomain || '';
            document.getElementById('databaseURLInput').value = firebaseConfig.databaseURL || '';
            document.getElementById('projectIdInput').value = firebaseConfig.projectId || '';
            document.getElementById('storageBucketInput').value = firebaseConfig.storageBucket || '';
            document.getElementById('messagingSenderIdInput').value = firebaseConfig.messagingSenderId || '';
            document.getElementById('appIdInput').value = firebaseConfig.appId || '';
        }
    }

    function saveFirebaseConfig() {
        firebaseConfig.apiKey = document.getElementById('apiKeyInput').value.trim();
        firebaseConfig.authDomain = document.getElementById('authDomainInput').value.trim();
        firebaseConfig.databaseURL = document.getElementById('databaseURLInput').value.trim();
        firebaseConfig.projectId = document.getElementById('projectIdInput').value.trim();
        firebaseConfig.storageBucket = document.getElementById('storageBucketInput').value.trim();
        firebaseConfig.messagingSenderId = document.getElementById('messagingSenderIdInput').value.trim();
        firebaseConfig.appId = document.getElementById('appIdInput').value.trim();

        if (firebaseConfig.apiKey && firebaseConfig.databaseURL) {
            initializeFirebase();
            showSyncStatus('Firebaseè¨­å®šå·²å„²å­˜ | Firebase config saved', 'success');
        } else {
            showSyncStatus('è«‹å¡«å¯«å¿…è¦æ¬„ä½ | Please fill required fields', 'error');
        }
    }

    function initializeFirebase() {
        if (firebaseConfig.configured) return;

        try {
            if (!window.firebase) {
                console.error('Firebase SDK not loaded');
                return;
            }

            firebase.initializeApp(firebaseConfig);
            firebaseDb = firebase.database();
            firebaseConfig.configured = true;

            console.log('âœ… Firebase initialized successfully!');

            loadFromFirebase();
            enableRealtimeSync();

            showSyncStatus('âœ… Firebaseå·²é€£æ¥ä¸¦å•Ÿç”¨å³æ™‚åŒæ­¥ | Firebase connected with real-time sync', 'success');
        } catch (error) {
            console.error('Firebase init failed:', error);
            showSyncStatus('Firebaseåˆå§‹åŒ–å¤±æ•— | Firebase init failed: ' + error.message, 'error');
        }
    }

    async function saveToFirebase() {
        if (!firebaseConfig.configured || !firebaseDb) {
            console.error('âš ï¸ Cannot save to Firebase: Not configured');
            return;
        }

        const data = {
            menuItems,
            orders,
            orderCounter,
            maxInventory,
            currentTheme,
            siteName,
            extraOptions,
            nextItemId,
            nextExtraOptionId,
            lastUpdated: new Date().toISOString()
        };

        console.log('ğŸ’¾ Saving to Firebase...', {
            orderCount: orders.length,
            orderCounter: orderCounter
        });

        try {
            await firebaseDb.ref('foodstand').set(data);
            console.log('âœ… Successfully saved to Firebase');
            showSyncStatus('âœ… å·²åŒæ­¥åˆ°Firebase | Synced to Firebase', 'success');
        } catch (error) {
            console.error('âŒ Firebase save failed:', error);
            showSyncStatus('âŒ FirebaseåŒæ­¥å¤±æ•— | Firebase sync failed: ' + error.message, 'error');
        }
    }

    async function loadFromFirebase() {
        if (!firebaseConfig.configured || !firebaseDb) {
            console.log('Firebase not configured, skipping load');
            return;
        }

        try {
            const snapshot = await firebaseDb.ref('foodstand').once('value');
            const data = snapshot.val();

            if (!data) {
                console.log('No data in Firebase yet, will use defaults');
                saveToFirebase();
                return;
            }

            if (data.menuItems && Array.isArray(data.menuItems)) {
                menuItems.length = 0;
                menuItems.push(...data.menuItems);
            }

            if (data.orders && Array.isArray(data.orders)) {
                orders.length = 0;
                orders.push(...data.orders);
            }

            orderCounter = data.orderCounter || 0;

            if (data.maxInventory) {
                Object.assign(maxInventory, data.maxInventory);
            }

            if (data.currentTheme) {
                currentTheme = data.currentTheme;
                applyTheme(currentTheme);
            }

            if (data.siteName) {
                Object.assign(siteName, data.siteName);
                updateSiteName();
            }

            if (data.extraOptions && Array.isArray(data.extraOptions)) {
                extraOptions.length = 0;
                extraOptions.push(...data.extraOptions);
            }

            nextItemId = data.nextItemId || 5;
            nextExtraOptionId = data.nextExtraOptionId || 2;

            renderMenu();
            updateCartDisplay();

            console.log('âœ… Data loaded from Firebase');
        } catch (error) {
            console.error('Firebase load failed:', error);
        }
    }

    let realtimeSyncEnabled = false;

    function enableRealtimeSync() {
        if (!firebaseConfig.configured || !firebaseDb) {
            console.error('Cannot enable real-time sync: Firebase not configured');
            return;
        }

        if (realtimeSyncEnabled) {
            console.log('Real-time sync already enabled');
            return;
        }

        console.log('ğŸ”„ Enabling real-time sync...');

        firebaseDb.ref('foodstand').on('value', (snapshot) => {
            try {
                const data = snapshot.val();

                if (!data) {
                    console.log('No data in Firebase');
                    return;
                }

                console.log('ğŸ“¥ Receiving data from Firebase...', data);

                if (data.menuItems && Array.isArray(data.menuItems)) {
                    menuItems.length = 0;
                    menuItems.push(...data.menuItems);
                    console.log('Menu items updated:', menuItems.length);
                }

                if (data.orders && Array.isArray(data.orders)) {
                    const oldOrderCount = orders.length;
                    orders.length = 0;
                    orders.push(...data.orders);
                    console.log(`Orders updated: ${oldOrderCount} â†’ ${orders.length}`);
                }

                orderCounter = data.orderCounter || 0;

                if (data.maxInventory) {
                    Object.assign(maxInventory, data.maxInventory);
                }

                if (data.currentTheme) {
                    currentTheme = data.currentTheme;
                }

                if (data.siteName) {
                    Object.assign(siteName, data.siteName);
                    updateSiteName();
                }

                if (data.extraOptions && Array.isArray(data.extraOptions)) {
                    extraOptions.length = 0;
                    extraOptions.push(...data.extraOptions);
                }

                nextItemId = data.nextItemId || 5;
                nextExtraOptionId = data.nextExtraOptionId || 2;

                try {
                    renderMenu();
                    updateCartDisplay();

                    const kitchenView = document.getElementById('kitchenView');
                    if (kitchenView && !kitchenView.classList.contains('hidden')) {
                        console.log('ğŸ”„ Updating kitchen view...');
                        
                        // Check which tab is currently active
                        const ordersTab = document.getElementById('ordersTab');
                        const statisticsTab = document.getElementById('statisticsTab');
                        const settingsTab = document.getElementById('settingsTab');
                        
                        if (!ordersTab.classList.contains('hidden')) {
                            // Orders tab is active
                            renderPendingOrders();
                            renderCompletedOrders();
                        } else if (!statisticsTab.classList.contains('hidden')) {
                            // Statistics tab is active
                            renderStatistics();
                        } else if (!settingsTab.classList.contains('hidden')) {
                            // Settings tab is active - update all settings views
                            renderColorThemeSelector();
                            renderMenuManagement();
                            renderExtraOptionsManagement();
                            renderSettings();
                            loadSiteNameToSettings();
                        }
                    }

                    console.log('âœ… UI updated successfully');
                } catch (renderError) {
                    console.error('Render error:', renderError);
                }
            } catch (error) {
                console.error('Real-time sync error:', error);
            }
        }, (error) => {
            console.error('Firebase listener error:', error);
        });

        realtimeSyncEnabled = true;
        console.log('âœ… Real-time sync enabled');
    }

    function clearCompletedOrders() {
        showConfirmDialog(
            'ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å·²å®Œæˆè¨‚å–®å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚<br>Are you sure you want to clear all completed orders? This cannot be undone.',
            () => {
                orders = orders.filter(order => !order.completed);
                
                // Update UI immediately
                renderPendingOrders();
                renderCompletedOrders();
                renderStatistics();
                
                // Then sync to Firebase
                saveToFirebase();
                showSyncStatus('âœ… å·²å®Œæˆè¨‚å–®å·²æ¸…é™¤ | Completed orders cleared', 'success');
            }
        );
    }

    function resetAllOrders() {
        showConfirmDialog(
            'âš ï¸ ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è¨‚å–®å—ï¼Ÿé€™æœƒåˆªé™¤æ‰€æœ‰å¾…è™•ç†å’Œå·²å®Œæˆçš„è¨‚å–®ï¼æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚<br>Are you sure you want to reset ALL orders? This will delete all pending and completed orders! This cannot be undone.',
            () => {
                orders = [];
                
                // Update UI immediately
                renderPendingOrders();
                renderCompletedOrders();
                renderStatistics();
                
                // Then sync to Firebase
                saveToFirebase();
                showSyncStatus('âœ… æ‰€æœ‰è¨‚å–®å·²é‡ç½® | All orders reset', 'success');
            }
        );
    }

    function resetOrderCounter() {
        showConfirmDialog(
            'ç¢ºå®šè¦é‡ç½®è¨‚å–®ç·¨è™Ÿè¨ˆæ•¸å™¨å—ï¼Ÿä¸‹ä¸€å€‹è¨‚å–®å°‡å¾ #1 é–‹å§‹ã€‚<br>Are you sure you want to reset the order counter? Next order will start from #1.',
            () => {
                orderCounter = 0;
                saveToFirebase();
                showSyncStatus('âœ… è¨‚å–®ç·¨è™Ÿå·²é‡ç½® | Order counter reset', 'success');
            }
        );
    }
</script>
```

</body>
</html>
